# zmodload zsh/zprof # uncomment for profiling

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Path to your oh-my-zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes
ZSH_THEME="powerlevel10k/powerlevel10k"

plugins=(
  kubectl # kubectl completion & aliases [k = kubectl]
  docker
  nvm
  git # git completion & aliases [g = git]
  macos
  fzf
  z
  zsh-autosuggestions
  zsh-syntax-highlighting
)

# Plugin settings are set before oh-my-zsh is sourced
export KUBECONFIG=$HOME/.kube/config # set kubeconfig file location to control cluster from this machine
NVM_LAZY=1 # start nvm when calling node, npm, yarn, or nvm
# NVM_AUTOLOAD=1 # load nvm when a .nvmrc file is in current directory (will call nvm on directory load)
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=#ffffff,bold,underline"

# Any new environments (including dev containers) will depend on both fzf and fd being installed and in path
# Configure fd to ignore .gitignore files
if command -v fdfind &> /dev/null; then
  alias fd="fdfind"
  export FZF_DEFAULT_COMMAND='fdfind --type f --hidden --follow --exclude .git'
elif command -v fd &> /dev/null; then
  export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
fi 
# To apply the command to CTRL-T as well
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"

# MacOS Specific config
if [[ $OSTYPE == darwin* ]]; then
  bindkey "รง" fzf-cd-widget # bind "ALT-C" for MacOS fzf
  PATH="$HOME/Library/Python/3.7/bin:${PATH}" # python 3 packages from pip are here
  PATH="/Applications/Visual Studio Code.app/Contents/Resources/app/bin:${PATH}"

  # add mysql command line utilities from MySQL Workbench
  PATH=$PATH:/Applications/MySQLWorkbench.app/Contents/MacOS

  # add cmake to path - this was installed via dmg from their downloads
  PATH="/Applications/CMake.app/Contents/bin":"$PATH"

  # add personal snippets to path
  PATH="$HOME/Projects/snippets":"$PATH"

  alias pip="/usr/bin/pip3"

  # https://www.jenv.be/
  # load jenv path for java version management
  PATH="$HOME/.jenv/bin:$PATH"
  eval "$(jenv init -)"
  # NOTE: added AdoptOpenJDK 8 to jenv
fi

source $ZSH/oh-my-zsh.sh

# aliases
alias ll="ls -lahG"
# Set python 3 as our default python interpreter - seems this python is included from xcode tools
alias python="/usr/bin/python3"

# general requirement for bash completion
autoload -U +X compinit && compinit
autoload -U +X bashcompinit && bashcompinit

# load golang bin path
PATH="$HOME/go/bin:$PATH"
export GOPATH="$HOME/go"

# load rust bin path
PATH="$HOME/.cargo/bin:$PATH"

# add personal binaries to path
PATH="$HOME/bin":"$PATH"

# Journaling shortcuts
J=$HOME/Projects/personal/journal
alias journal="mkdir -p $J/$(date +'%Y/%m') && code $J/$(date +'%Y/%m/%Y-%m-%d.md')"

export REPO="git@gitlab.mattbensondev.com:322" # work gitlab shortcut

# make path additions accessible to any outsite program
export PATH

# hide user@location on command line
# prompt_context(){}

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# zprof # uncomment for profiling
